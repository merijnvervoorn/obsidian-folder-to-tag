{"version":3,"file":"main.js","sources":["main.ts"],"sourcesContent":["import { App, Plugin, TFile, Notice, PluginSettingTab, Setting, normalizePath } from \"obsidian\";\n\ninterface FolderTagPluginSettings {\n    folderDepth: \"1\" | \"2split\" | \"2single\" | \"full\";\n    tagPrefix: string;\n    tagSuffix: string;\n}\n\nconst DEFAULT_SETTINGS: FolderTagPluginSettings = {\n    folderDepth: \"1\",\n    tagPrefix: \"\",\n    tagSuffix: \"\"\n};\n\nexport default class FolderTagPlugin extends Plugin {\n    settings!: FolderTagPluginSettings;\n\n    async onload() {\n        await this.loadSettings();\n        this.addSettingTab(new FolderTagSettingTab(this.app, this));\n\n        this.registerEvent(this.app.vault.on(\"create\", async (file) => {\n            if (file instanceof TFile && file.extension === \"md\") {\n                await this.applyFolderTag(file, \"create\");\n            }\n        }));\n\n        this.registerEvent(this.app.vault.on(\"rename\", async (file, oldPath) => {\n            if (file instanceof TFile && file.extension === \"md\") {\n                await this.applyFolderTag(file, \"move\", oldPath);\n            }\n        }));\n    }\n\n    async loadSettings() {\n        this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());\n    }\n\n    async saveSettings() {\n        await this.saveData(this.settings);\n    }\n\n    private getFolderTags(file: TFile): string[] {\n        return this.getFolderTagsFromPath(file.path);\n    }\n\n    private getFolderTagsFromPath(path: string): string[] {\n        const normalized = normalizePath(path);\n        const parts = normalized.split(\"/\").slice(0, -1);\n        if (!parts.length) return [];\n\n        const { folderDepth, tagPrefix, tagSuffix } = this.settings;\n        let tags: string[] = [];\n\n        switch (folderDepth) {\n            case \"1\":\n                tags.push(tagPrefix + parts[parts.length - 1] + tagSuffix);\n                break;\n            case \"2split\":\n                if (parts.length >= 2) {\n                    tags.push(tagPrefix + parts[parts.length - 1] + tagSuffix);\n                    tags.push(tagPrefix + parts[parts.length - 2] + tagSuffix);\n                } else {\n                    tags.push(tagPrefix + parts[parts.length - 1] + tagSuffix);\n                }\n                break;\n            case \"2single\":\n                if (parts.length >= 2) {\n                    tags.push(tagPrefix + parts[parts.length - 2] + \"/\" + parts[parts.length - 1] + tagSuffix);\n                } else {\n                    tags.push(tagPrefix + parts[parts.length - 1] + tagSuffix);\n                }\n                break;\n            case \"full\":\n                tags.push(tagPrefix + parts.join(\"/\") + tagSuffix);\n                break;\n        }\n\n        return tags;\n    }\n\n    // -------------------------\n    // Apply folder tags\n    // -------------------------\n    async applyFolderTag(file: TFile, action: \"create\" | \"move\" | \"rerun\", oldPath?: string) {\n        const folderTags = this.getFolderTags(file);\n        if (!folderTags.length) return;\n\n        await this.app.fileManager.processFrontMatter(file, yaml => {\n            if (!yaml || typeof yaml !== \"object\") return;\n\n            let existingTags: string[] = [];\n            if (\"tags\" in yaml) {\n                if (Array.isArray(yaml.tags)) existingTags.push(...yaml.tags.map((t: string | number) => String(t).trim()));\n                else if (typeof yaml.tags === \"string\") existingTags.push(...yaml.tags.split(\",\").map((t: string) => t.trim()));\n            }\n\n            // Remove old folder tags if moving/rerunning\n            if ((action === \"move\" || action === \"rerun\") && oldPath) {\n                const oldTags = this.getFolderTagsFromPath(oldPath);\n                existingTags = existingTags.filter(t => !oldTags.includes(t));\n            }\n\n            // Add new folder tags\n            folderTags.forEach(t => { if (!existingTags.includes(t)) existingTags.push(t); });\n\n            yaml.tags = existingTags;\n        });\n    }\n\n\n    // -------------------------\n    // Remove folder tags\n    // -------------------------\n    async removeFolderTags(file: TFile) {\n        const folderTags = this.getFolderTags(file);\n        if (!folderTags.length) return;\n\n        await this.app.fileManager.processFrontMatter(file, yaml => {\n            if (!yaml || typeof yaml !== \"object\") return;\n\n            let existingTags: string[] = [];\n            if (\"tags\" in yaml) {\n                const val = yaml.tags;\n                if (Array.isArray(val)) existingTags.push(...val.map(v => String(v).trim()));\n                else if (typeof val === \"string\") existingTags.push(...val.split(\",\").map(v => v.trim()));\n            }\n\n            existingTags = existingTags.filter(t => !folderTags.includes(t));\n\n            if (existingTags.length === 0) delete yaml.tags;\n            else yaml.tags = existingTags;\n        });\n    }\n}\n\n// -------------------------\n// Settings Tab\n// -------------------------\nclass FolderTagSettingTab extends PluginSettingTab {\n    plugin: FolderTagPlugin;\n\n    constructor(app: App, plugin: FolderTagPlugin) {\n        super(app, plugin);\n        this.plugin = plugin;\n    }\n\n    display(): void {\n        const { containerEl } = this;\n        containerEl.empty();\n        new Setting(containerEl).setHeading().setName(\"Folder to tag\");\n\n        new Setting(containerEl)\n            .setName(\"Folder depth\")\n            .addDropdown(drop => {\n                drop.addOption(\"1\", \"Depth 1\")\n                    .addOption(\"2split\", \"Depth 2 (separate tags)\")\n                    .addOption(\"2single\", \"Depth 2 in one tag\")\n                    .addOption(\"full\", \"Full path\")\n                    .setValue(this.plugin.settings.folderDepth)\n                    .onChange(async value => {\n                        this.plugin.settings.folderDepth = value as FolderTagPluginSettings[\"folderDepth\"];\n                        await this.plugin.saveSettings();\n                    });\n            });\n\n        new Setting(containerEl)\n            .setName(\"Tag prefix\")\n            .addText(txt => txt\n                .setValue(this.plugin.settings.tagPrefix)\n                .onChange(async value => {\n                    this.plugin.settings.tagPrefix = value;\n                    await this.plugin.saveSettings();\n                })\n            );\n\n        new Setting(containerEl)\n            .setName(\"Tag suffix\")\n            .addText(txt => txt\n                .setValue(this.plugin.settings.tagSuffix)\n                .onChange(async value => {\n                    this.plugin.settings.tagSuffix = value;\n                    await this.plugin.saveSettings();\n                })\n            );\n\n        new Setting(containerEl)\n            .setName(\"Reapply tags to all notes\")\n            .addButton(btn => btn\n                .setButtonText(\"Reapply to all notes\")\n                .setCta()\n                .onClick(async () => {\n                    new Notice(\"Updating all notes...\");\n                    const files = this.plugin.app.vault.getMarkdownFiles();\n                    for (const file of files) {\n                        try {\n                            await this.plugin.applyFolderTag(file, \"rerun\");\n                        } catch (e) {\n                            console.error(\"Failed for file:\", file.path, e);\n                            new Notice(`Failed to process: ${file.path}`);\n                        }\n                    }\n                    new Notice(\"Folder tags updated for all notes!\");\n                })\n            );\n\n\n        new Setting(containerEl)\n            .setName(\"Remove all folder tags\")\n            .addButton(btn => btn\n                .setButtonText(\"Remove folder tags\")\n                .setCta()\n                .onClick(async () => {\n                    new Notice(\"Removing folder tags from all notes...\");\n                    const files = this.plugin.app.vault.getMarkdownFiles();\n                    for (const file of files) {\n                        await this.plugin.removeFolderTags(file);\n                    }\n                    new Notice(\"All folder tags removed!\");\n                })\n            );\n    }\n}\n"],"names":["Plugin","TFile","normalizePath","PluginSettingTab","Setting","Notice"],"mappings":"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"}